
vue + vite

## 需求  
本地开发时访问项目地址如 `localhost:3000`  

后面接路由如 `localhost:3000/home`  

生产环境时，如果将打包后的dist文件放到了某个文件夹里 访问的地址可能是 `http://192.168.56.1:4173/deploy-repo/arcgis-demo`  

后面接路由如 `http://192.168.56.1:4173/deploy-repo/arcgis-demo/home`  

vite应该如何处理不同的环境变量呢  

## 思路  

根目录下两个文件 .env.production     .env.development  

根据环境不同在vit.config.ts中设置不同的base即可。  


## 开发环境  





## 测试环境/生产环境  

### 实现  

```js title='.env.production'

VITE_BASE_URL = '/deploy-repo/arcgis-demo' 

```

```ts title='vite.config.ts'

import { defineConfig, loadEnv } from 'vite'

// https://vitejs.dev/config/
export default defineConfig( ({mode}) => {
  // 根据当前工作目录中的 `mode` 加载 .env 文件
  // 设置第三个参数为 '' 来加载所有环境变量，而不管是否有 `VITE_` 前缀。
  const env = loadEnv(mode, process.cwd());
  return {

    base: env?.VITE_BASE_URL, // 更改打包路径
    // ...
  }
})


```
### 验证  

可以本地 npm run build ,然后 npm run preview 看看  

![vite-preview](./imgs/vite-preview.png)   

可以看到路径就是我想要的。  


## 注意    

### 如何在嵌套的公共路径下部署项目?  

问题什么意思?  
就是我不是在`http://192.168.56.1:4173`下部署项目  
而是在`http://192.168.56.1:4173/deploy-repo/arcgis-demo`下部署项目    


只需要指定 base即可。  

[官方文档：公共基础路径](https://cn.vitejs.dev/guide/build#public-base-path)  
[官方文档：base](https://cn.vitejs.dev/config/shared-options#base)  


### vite.config.ts中怎么拿.env里的环境变量呢?  

[官方文档：在配置中使用环境变量](https://cn.vitejs.dev/config/#using-environment-variables-in-config)

### vite.config.ts中怎么判断用哪个环境的变量?  

根据mode判断  

[官方文档：mode](https://cn.vitejs.dev/config/shared-options#mode)   


### .env里的变量如何使用?   

`import.meta.env.VITE_BASE_URL`  

- 

---

https://juejin.cn/post/7172012247852515335#heading-1