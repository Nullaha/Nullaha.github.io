---
sidebar_position: 2
title: Âä†ËΩΩgeoserverÁöÑwmts
description: Âä†ËΩΩgeoserverÁöÑwmts
date: 2024-6-25

tags: [arcgis for js4, gis, wmts, geoserver]
---


## ‰∏Ä„ÄÅÊÄé‰πàÁ°ÆÂÆöÊàëÂú®geoserver‰∏äÂèëÂ∏ÉÁöÑÊúçÂä°ÊòØwmtsÂë¢?  

[geoserverÂèëÂ∏ÉÂõæÂ±ÇÊúçÂä°](../geoserver/geoserverÂèëÂ∏ÉÂõæÂ±ÇÊúçÂä°)



## ‰∫å„ÄÅÊÄé‰πàÊâæÂà∞ËØ∑Ê±ÇÂú∞ÂùÄ,Â∞±ÂÉèËØ∑Ê±ÇÂ§©Âú∞ÂõæÂú∞ÂùÄÈÇ£Ê†∑?

[ÂèÇËÄÉÔºöArcGIS API for JavaScript 4.xÂä†ËΩΩGeoServerÂèëÂ∏ÉÁöÑWMTSÊúçÂä°](https://www.cnblogs.com/youzi-xuchongyou/p/17337077.html)  


### 1 ÈÄöËøá wmts GetCapabilities  


```md
http://xxx.xxx.x.xxx:xxxx/geoServer/gwc/service/wmts?REQUEST=GetCapabilities
```
Âú®ÊµèËßàÂô®‰∏≠ËÆøÈóÆ WMTS ÊúçÂä°ÁöÑ GetCapabilities URLÔºå‰ª•È™åËØÅÈÖçÁΩÆÊòØÂê¶Ê≠£Á°Æ„ÄÇ  
üëÜ‰ºöÂ±ïÁ§∫ÊâÄÊúâÁöÑwmtsÂõæÂ±ÇÊúçÂä°„ÄÇ

ÊêúÁ¥¢‰Ω†ÊÉ≥Ë¶ÅÁöÑÈÇ£‰∏™ÂõæÂ±ÇÔºåÊØîÂ¶Çaha  

![urlTemplate](./img/Âä†ËΩΩwmts/urlTemplate.png)  


```md 
http://xxx.xxx.x.xxx:xxxx/geoServer/gwc/service/wmts/rest/testt:aha_test222/{style}/{TileMatrixSet}/{TileMatrix}/{TileRow}/{TileCol}?format=image/png
```

- `{style}` ÂéªÂì™ÈáåÊâæÂë¢? 

![style](./img/Âä†ËΩΩwmts/style.png)  

```md 
http://xxx.xxx.x.xxx:xxxx/geoServer/gwc/service/wmts/rest/testt:aha_test222/{style}/{TileMatrixSet}/{TileMatrix}/{TileRow}/{TileCol}?format=image/png

{style} Â∞±ÊõøÊç¢‰∏∫aaaaaaa_test
```

- `{TileMatrixSet}` ÂéªÂì™ÈáåÊâæÂë¢? 
tilematrixset

![tilematrixset](./img/Âä†ËΩΩwmts/tilematrixset.png)  

```md 
http://xxx.xxx.x.xxx:xxxx/geoServer/gwc/service/wmts/rest/testt:aha_test222/aaaaaaa_test/{TileMatrixSet}/{TileMatrix}/{TileRow}/{TileCol}?format=image/png

{TileMatrixSet} Â∞±ÊõøÊç¢‰∏∫ EPSG:4490
{TileMatrix} ÊõøÊç¢‰∏∫ EPSG:4490:{TileMatrix}
```

ÊúÄÂêéÂæóÂà∞Ôºö

```md 
http://xxx.xxx.x.xxx:xxxx/geoServer/gwc/service/wmts/rest/testt:aha_test222/aaaaaaa_test/EPSG:4490/EPSG:4490:{TileMatrix}/{TileRow}/{TileCol}?format=image/png

```

‰Ω†ÂèØ‰ª•ÂÜô‰∏Ä‰∏™TileMatrix„ÄÅrow„ÄÅcolÔºåÁÑ∂ÂêéÂú®ÊµèËßàÂô®‰∏äÁúã‰∏ÄÁúº„ÄÇ


### 2 (Êé®Ëçê) ÈÄöËøáÁì¶ÁâáÂõæÂ±ÇÈ¢ÑËßà  

1. Âú®geoserver -> Áì¶ÁâáÂõæÂ±Ç ‰∏≠È¢ÑËßàÂèëÂ∏ÉÁöÑÂõæÂ±Ç  


![Áì¶ÁâáÂõæÂ±ÇÈ¢ÑËßà](./img/Âä†ËΩΩwmts/Áì¶ÁâáÂõæÂ±ÇÈ¢ÑËßà.png)  

2. ÊâìÂºÄ ÊéßÂà∂Âè∞ ÁúãÂÆÉÁöÑËØ∑Ê±Ç   

![Áì¶ÁâáÂõæÂ±ÇÁöÑËØ∑Ê±Ç](./img/Âä†ËΩΩwmts/wmtsËØ∑Ê±Ç.png)  

3. ÊâìÂºÄ ÊéßÂà∂Âè∞ ÁúãÂÆÉÁöÑËØ∑Ê±Ç   

![Áì¶ÁâáÂõæÂ±ÇÁöÑËØ∑Ê±Ç](./img/Âä†ËΩΩwmts/ÂèÇÊï∞Ëß£Êûê.png)  

4. ÊúÄÂêéÂæóÂà∞Ôºö

```md 
http://xxx.xxx.x.xxx:xxxx/geoServer/gwc/service/wmts/rest/testt:aha_test222/aaaaaaa_test/EPSG:4490/EPSG:4490:{TileMatrix}/{TileRow}/{TileCol}?format=image/png


http://xxx.xxx.x.xxx:xxxx/geoServer/gwc/service/wmts?layer=ÂõæÂ±ÇÁ©∫Èó¥%3AÂõæÂ±ÇÂêç&style=&tilematrixset=EPSG%3A4490&Service=WMTS&Request=GetTile&Version=1.0.0&Format=image%2Fpng&TileMatrix=EPSG%3A4490%3A{TileMatrix}&TileCol={TileCol}&TileRow={TileRow}

// %3A ÊòØÂÜíÂè∑„ÄÇ

```


### ÊÄªÁªì  

‰∏§ÁßçÊñπÂºèÊúÄÁªàÂæóÂà∞ÁöÑurlTemplateÈÉΩÂèØ‰ª•Áî®„ÄÇ




## ‰∏â„ÄÅarcgis js4 ÊÄé‰πàÂä†ËΩΩ geoserver wmts?  

Áî®WMTSLayerËøòÊòØWebTileLayer  

### ~~Áî®WMTSLayer~~  

```js title='‰ΩøÁî®WMTSLayer.js'
import WMTSLayer from "@arcgis/core/layers/WMTSLayer.js";
new WMTSLayer({
    // url: "https://gibs.earthdata.nasa.gov/wmts/epsg4326/best", // url to the service
    url: 'http://xxx.xxx.x.xxx:xxxx/geoServer/gwc/service/wmts',

    activeLayer: {
    // id: "SRTM_Color_Index",
    id: 'ÂõæÂ±ÇÁ©∫Èó¥:ÂõæÂ±ÇÂêç',
    }
});
```


![Êä•Èîô_Unable_to_load_tile](./img/Âä†ËΩΩwmts/Êä•Èîô_Unable_to_load_tile.png)  

Êó†Ëß£„ÄÇ

ÁúãËØ∑Ê±ÇÊòØ200Ôºå‰ΩÜÊòØarcgisËß£Êûê‰∏ç‰∫ÜÂÆÉ„ÄÇ  



### Áî®WebTileLayer  


```js title='‰ΩøÁî®WebTileLayer.js'
import WebTileLayer from "@arcgis/core/layers/WebTileLayer.js";

const configData =   {
    id:'3',
    name:'geoserver_wmts_WebTileLayer',
    type: "wmts",
    // urlTemplate: "http://xxx.xxx.x.xxx:xxxx/geoServer/gwc/service/wmts/rest/testt:aha/{style}/{TileMatrixSet}/{TileMatrix}/{TileRow}/{TileCol}?format=image/png",
    // urlTemplate: "http://xxx.xxx.x.xxx:xxxx/geoServer/gwc/service/wmts/rest/testt%3Aaha/testt%3Aahastyle/EPSG%3A4490/EPSG%3A4490%3A{level}/{row}/{col}?format=image/png",
    urlTemplate: "http://xxx.xxx.x.xxx:xxxx/geoServer/gwc/service/wmts?layer=testt%3Aaha&style=&tilematrixset=EPSG%3A4490&Service=WMTS&Request=GetTile&Version=1.0.0&Format=image%2Fpng&TileMatrix=EPSG%3A4490%3A{level}&TileCol={col}&TileRow={row}",
    layerTable:'aha',
    layerType: "geoserverWMTS_WebTileLayer"      
}
new WebTileLayer({
    id: configData.id,
    urlTemplate: configData.urlTemplate,
    tileInfo: tileInfo4490,
    spatialReference: this.view.spatialReference,
    title: configData.name,
});
```


#### tileOutOfRangeÊä•Èîô  

![Êä•Èîô_tileOutOfRange](./img/Âä†ËΩΩwmts/Êä•Èîô_tileOutOfRange.png)  

1. Âá∫Áé∞ÁöÑÂéüÂõ†1:Êü•ÁúãËåÉÂõ¥Ë∂ÖÂá∫ÂΩ±ÂÉèÊï∞ÊçÆÁöÑËåÉÂõ¥?  

Â¶ÇÊûúÊòØÂõ†‰∏∫Êü•ÁúãËåÉÂõ¥Ë∂ÖÂá∫‰∫ÜÂΩ±ÂÉèÊï∞ÊçÆÁöÑËåÉÂõ¥ÔºåËøôÁßçÊä•ÈîôÔºåÂ•ΩÂÉèÊó†ÊâÄË∞ì„ÄÇ

‰Ω†ÂéªÊü•ÁúãÂΩ±ÂÉèÊâÄÂú®ÁöÑËåÉÂõ¥ÔºåËøòÊòØËÉΩÊü•ÁúãÂà∞ÂΩ±ÂÉèÁöÑ„ÄÇ  

2. Âá∫Áé∞ÁöÑÂéüÂõ†2: geoserverÁöÑgridsetÂíåWebTileLayerÁöÑtileInfoÊ≤°ÂØπ‰∏ä  

ÊàëÊµãËØï‰∫ÜgeoserverÁöÑgridsetÁî®4490 ÔºåWebTileLayerÁöÑtileInfoÁî®Â§©Âú∞ÂõæÁöÑÂ∞±‰ºöÊä•Ëøô‰∏™ÈîôËØØ„ÄÇ  

ÊâÄ‰ª•Ëß£ÂÜ≥ÊñπÊ≥ïÂ∞±ÊòØËÆ©‰∏§ËÄÖ‰∏ÄËá¥ÂíØ„ÄÇ  


## WebTileLayer.tileInfo.lods ‰ªéÂì™ÈáåÊãø?     






### 4490ÁöÑlods  

Â¶ÇÊûúÊòØgeoserverÂèëÂ∏ÉÁöÑwmtsÂàáÁâáÈúÄË¶ÅÁî®Âà∞WebTileLayer -> tileInfo -> lods ,  

ÂàôÁõ¥Êé•ÂéªgeoserverÁöÑ gridset copy ÂØπÂ∫îÁöÑËøáÊù•Â∞±Ë°å‰∫Ü„ÄÇ

```js 'title=4490.js'
export const initialExtent = {
    xmin: -180,
    ymin: -90,
    xmax: 180,
    ymax: 90,
    spatialReference: {
        wkid: 4490,
    }
};

export const fullExtent = {
    xmin: -180,
    ymin: -90,
    xmax: 180,
    ymax: 90,
    spatialReference: {
        wkid: 4490,
    }
};

export const lods = [
    {
        level: 1,
        resolution: 0.3515625,
        scale: 139770566.00717944
    },
    {
        level: 2,
        resolution: 0.17578125,
        scale: 69885283.00358972
    },
    {
        level: 3,
        resolution: 0.087890625,
        scale: 34942641.50179486
    },
    {
        level: 4,
        resolution: 0.0439453125,
        scale: 17471320.75089743
    },
    {
        level: 5,
        resolution: 0.02197265625,
        scale: 8735660.375448715
    },
    {
        level: 6,
        resolution: 0.010986328125,
        scale: 4367830.1877243575
    },
    {
        level: 7,
        resolution: 0.0054931640625,
        scale: 2183915.0938621787
    },
    {
        level: 8,
        resolution: 0.00274658203125,
        scale: 1091957.5469310894
    },
    {
        level: 9,
        resolution: 0.001373291015625,
        scale: 545978.7734655447
    },
    {
        level: 10,
        resolution: 0.0006866455078125,
        scale: 272989.38673277234
    },
    {
        level: 11,
        resolution: 0.0003433227539062,
        scale: 136494.69336636632
    },
    {
        level: 12,
        resolution: 0.0001716613769531,
        scale: 68247.34668318316
    },
    {
        level: 13,
        resolution: 0.0000858306884766,
        scale: 34123.67334161145
    },
    {
        level: 14,
        resolution: 0.0000429153442383,
        scale: 17061.836670805726
    },
    {
        level: 15,
        resolution: 0.0000214576721191,
        scale: 8530.918335382985
    },
    {
        level: 16,
        resolution: 0.0000107288360596,
        scale: 4265.45916771137
    },
    // {
    //     level: 17,
    //     resolution: 0.0000053644180298,
    //     scale: 2132.729583855685
    // },
    // {
    //     level: 18,
    //     resolution: 0.0000026822090149,
    //     scale: 1066.3647919278426
    // },
    // {
    //     level: 19,
    //     resolution: 0.0000013411045074,
    //     scale: 533.1823959440429
    // },
    // {
    //     level: 20,
    //     resolution: 0.0000006705522537,
    //     scale: 266.59119797202146
    // },
    // {
    //     level: 21,
    //     resolution: 0.0000003352761269,
    //     scale: 133.2955990058892
    // },
    // {
    //     level: 22,
    //     resolution: 0.0000001676380634,
    //     scale: 66.64779948306612
    // },
    // {
    //     level: 23,
    //     resolution: 0.0000000838190317,
    //     scale: 33.32389974153306
    // },
    // {
    //     level: 24,
    //     resolution: 0.0000000419095159,
    //     scale: 16.66194989064501
    // },
];

export default {
    dpi: 96,
    rows: 256,
    cols: 256,
    compressionQuality: 0,
    origin: {
        x: -180,
        y: 90,
    },
    spatialReference: {
        wkid: 4490
    },
    lods,
};

```



## ÂèÇËÄÉ  
[ArcGIS API for JavaScript 4.xÂä†ËΩΩGeoServerÂèëÂ∏ÉÁöÑWMTSÊúçÂä°](https://www.cnblogs.com/youzi-xuchongyou/p/17337077.html)
[geoserverÂèëÂ∏ÉwmtsÊúçÂä°Âπ∂‰ΩøÁî®arcgis js4.xË∞ÉÁî®](https://blog.csdn.net/FlyToTheWorld/article/details/125906392)

[Â§©Âú∞ÂõæÂÆòÊñπÊñáÊ°£](http://lbs.tianditu.gov.cn/server/MapService.html)













