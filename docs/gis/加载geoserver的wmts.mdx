---
sidebar_position: 2
title: åŠ è½½geoserverçš„wmts
description: åŠ è½½geoserverçš„wmts
date: 2024-6-25

tags: [arcgis for js4, gis, wmts, geoserver]
---


## æ€ä¹ˆç¡®å®šæˆ‘åœ¨geoserverä¸Šå‘å¸ƒçš„æœåŠ¡æ˜¯wmtså‘¢?  

[geoserverå‘å¸ƒå›¾å±‚æœåŠ¡](./geoserverå‘å¸ƒå›¾å±‚æœåŠ¡.mdx)



## æ€ä¹ˆæ‰¾åˆ°è¯·æ±‚åœ°å€,å°±åƒè¯·æ±‚å¤©åœ°å›¾åœ°å€é‚£æ ·?

[å‚è€ƒï¼šArcGIS API for JavaScript 4.xåŠ è½½GeoServerå‘å¸ƒçš„WMTSæœåŠ¡](https://www.cnblogs.com/youzi-xuchongyou/p/17337077.html)  


### æ–¹å¼ä¸€ï¼šé€šè¿‡ wmts GetCapabilities  


```md
http://xxx.xxx.x.xxx:xxxx/geoServer/gwc/service/wmts?REQUEST=GetCapabilities
```
åœ¨æµè§ˆå™¨ä¸­è®¿é—® WMTS æœåŠ¡çš„ GetCapabilities URLï¼Œä»¥éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®ã€‚  
ğŸ‘†ä¼šå±•ç¤ºæ‰€æœ‰çš„wmtså›¾å±‚æœåŠ¡ã€‚

æœç´¢ä½ æƒ³è¦çš„é‚£ä¸ªå›¾å±‚ï¼Œæ¯”å¦‚aha  

![urlTemplate](./img//geoserver/åŠ è½½wmts/urlTemplate.png)  


```md 
http://xxx.xxx.x.xxx:xxxx/geoServer/gwc/service/wmts/rest/testt:aha_test222/{style}/{TileMatrixSet}/{TileMatrix}/{TileRow}/{TileCol}?format=image/png
```

- `{style}` å»å“ªé‡Œæ‰¾å‘¢? 

![style](./img//geoserver/åŠ è½½wmts/style.png)  

```md 
http://xxx.xxx.x.xxx:xxxx/geoServer/gwc/service/wmts/rest/testt:aha_test222/{style}/{TileMatrixSet}/{TileMatrix}/{TileRow}/{TileCol}?format=image/png

{style} å°±æ›¿æ¢ä¸ºaaaaaaa_test
```

- `{TileMatrixSet}` å»å“ªé‡Œæ‰¾å‘¢? 
tilematrixset

![tilematrixset](./img//geoserver/åŠ è½½wmts/tilematrixset.png)  

```md 
http://xxx.xxx.x.xxx:xxxx/geoServer/gwc/service/wmts/rest/testt:aha_test222/aaaaaaa_test/{TileMatrixSet}/{TileMatrix}/{TileRow}/{TileCol}?format=image/png

{TileMatrixSet} å°±æ›¿æ¢ä¸º EPSG:4490
{TileMatrix} æ›¿æ¢ä¸º EPSG:4490:{TileMatrix}
```

æœ€åå¾—åˆ°ï¼š

```md 
http://xxx.xxx.x.xxx:xxxx/geoServer/gwc/service/wmts/rest/testt:aha_test222/aaaaaaa_test/EPSG:4490/EPSG:4490:{TileMatrix}/{TileRow}/{TileCol}?format=image/png

```

ä½ å¯ä»¥å†™ä¸€ä¸ªTileMatrixã€rowã€colï¼Œç„¶ååœ¨æµè§ˆå™¨ä¸Šçœ‹ä¸€çœ¼ã€‚


### (æ¨è)æ–¹å¼äºŒï¼šé€šè¿‡ç“¦ç‰‡å›¾å±‚é¢„è§ˆ  

1. åœ¨geoserver -> ç“¦ç‰‡å›¾å±‚ ä¸­é¢„è§ˆå‘å¸ƒçš„å›¾å±‚  


![ç“¦ç‰‡å›¾å±‚é¢„è§ˆ](./img//geoserver/åŠ è½½wmts/ç“¦ç‰‡å›¾å±‚é¢„è§ˆ.png)  

2. æ‰“å¼€ æ§åˆ¶å° çœ‹å®ƒçš„è¯·æ±‚   

![ç“¦ç‰‡å›¾å±‚çš„è¯·æ±‚](./img//geoserver/åŠ è½½wmts/wmtsè¯·æ±‚.png)  

3. æ‰“å¼€ æ§åˆ¶å° çœ‹å®ƒçš„è¯·æ±‚   

![ç“¦ç‰‡å›¾å±‚çš„è¯·æ±‚](./img//geoserver/åŠ è½½wmts/å‚æ•°è§£æ.png)  

4. æœ€åå¾—åˆ°ï¼š

```md 
http://xxx.xxx.x.xxx:xxxx/geoServer/gwc/service/wmts/rest/testt:aha_test222/aaaaaaa_test/EPSG:4490/EPSG:4490:{TileMatrix}/{TileRow}/{TileCol}?format=image/png


http://xxx.xxx.x.xxx:xxxx/geoServer/gwc/service/wmts?layer=å›¾å±‚ç©ºé—´%3Aå›¾å±‚å&style=&tilematrixset=EPSG%3A4490&Service=WMTS&Request=GetTile&Version=1.0.0&Format=image%2Fpng&TileMatrix=EPSG%3A4490%3A{TileMatrix}&TileCol={TileCol}&TileRow={TileRow}

// %3A æ˜¯å†’å·ã€‚

```


### æ€»ç»“  

ä¸¤ç§æ–¹å¼æœ€ç»ˆå¾—åˆ°çš„urlTemplateéƒ½å¯ä»¥ç”¨ã€‚




## arcgis for js4 æ€ä¹ˆåŠ è½½wmts? ç”¨WMTSLayerè¿˜æ˜¯WebTileLayer  

### ç”¨WMTSLayer

```js
import WMTSLayer from "@arcgis/core/layers/WMTSLayer.js";
new WMTSLayer({
    // url: "https://gibs.earthdata.nasa.gov/wmts/epsg4326/best", // url to the service
    url: 'http://xxx.xxx.x.xxx:xxxx/geoServer/gwc/service/wmts',

    activeLayer: {
    // id: "SRTM_Color_Index",
    id: 'å›¾å±‚ç©ºé—´:å›¾å±‚å',
    }
});
```


![æŠ¥é”™_Unable_to_load_tile](./img//geoserver/åŠ è½½wmts/æŠ¥é”™_Unable_to_load_tile.png)  

æ— è§£ã€‚

çœ‹è¯·æ±‚æ˜¯200ï¼Œä½†æ˜¯arcgisè§£æä¸äº†å®ƒã€‚  



### ç”¨WebTileLayer  


```js
import WebTileLayer from "@arcgis/core/layers/WebTileLayer.js";

const configData =   {
    id:'3',
    name:'geoserver_wmts_WebTileLayer',
    type: "wmts",
    // urlTemplate: "http://xxx.xxx.x.xxx:xxxx/geoServer/gwc/service/wmts/rest/testt:aha/{style}/{TileMatrixSet}/{TileMatrix}/{TileRow}/{TileCol}?format=image/png",
    // urlTemplate: "http://xxx.xxx.x.xxx:xxxx/geoServer/gwc/service/wmts/rest/testt%3Aaha/testt%3Aahastyle/EPSG%3A4490/EPSG%3A4490%3A{level}/{row}/{col}?format=image/png",
    urlTemplate: "http://xxx.xxx.x.xxx:xxxx/geoServer/gwc/service/wmts?layer=testt%3Aaha&style=&tilematrixset=EPSG%3A4490&Service=WMTS&Request=GetTile&Version=1.0.0&Format=image%2Fpng&TileMatrix=EPSG%3A4490%3A{level}&TileCol={col}&TileRow={row}",
    layerTable:'aha',
    layerType: "geoserverWMTS_WebTileLayer"      
}
new WebTileLayer({
    id: configData.id,
    urlTemplate: configData.urlTemplate,
    tileInfo: tileInfo4490,
    spatialReference: this.view.spatialReference,
    title: configData.name,
});
```


#### tileOutOfRangeæŠ¥é”™  

![æŠ¥é”™_tileOutOfRange](./img//geoserver/åŠ è½½wmts/æŠ¥é”™_tileOutOfRange.png)  

1. å‡ºç°çš„åŸå› 1:æŸ¥çœ‹èŒƒå›´è¶…å‡ºå½±åƒæ•°æ®çš„èŒƒå›´?  

å¦‚æœæ˜¯å› ä¸ºæŸ¥çœ‹èŒƒå›´è¶…å‡ºäº†å½±åƒæ•°æ®çš„èŒƒå›´ï¼Œè¿™ç§æŠ¥é”™ï¼Œå¥½åƒæ— æ‰€è°“ã€‚

ä½ å»æŸ¥çœ‹å½±åƒæ‰€åœ¨çš„èŒƒå›´ï¼Œè¿˜æ˜¯èƒ½æŸ¥çœ‹åˆ°å½±åƒçš„ã€‚  

2. å‡ºç°çš„åŸå› 2: geoserverçš„gridsetå’ŒWebTileLayerçš„tileInfoæ²¡å¯¹ä¸Š  

æˆ‘æµ‹è¯•äº†geoserverçš„gridsetç”¨4490 ï¼ŒWebTileLayerçš„tileInfoç”¨å¤©åœ°å›¾çš„å°±ä¼šæŠ¥è¿™ä¸ªé”™è¯¯ã€‚


## TODO: lods   

### å¤©åœ°å›¾çš„lods 


### 4490çš„lods  


















