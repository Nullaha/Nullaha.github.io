"use strict";(self.webpackChunknullaha_github_io=self.webpackChunknullaha_github_io||[]).push([[8293],{3784:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>i,contentTitle:()=>o,default:()=>c,frontMatter:()=>a,metadata:()=>l,toc:()=>d});var r=n(4848),t=n(8453);const a={sidebar_position:2,title:"geoserver\u53d1\u5e03\u56fe\u5c42\u670d\u52a1",description:"\u4f7f\u7528qgis\u5c06gdb\u6570\u636e\u5bfc\u5165\u5230postgreSQL\u4e2d",date:"2024-5-15",tags:["geoserver","python","gis","qgis","postgresql"]},o=void 0,l={id:"gis/geoserver\u53d1\u5e03\u56fe\u5c42\u670d\u52a1",title:"geoserver\u53d1\u5e03\u56fe\u5c42\u670d\u52a1",description:"\u4f7f\u7528qgis\u5c06gdb\u6570\u636e\u5bfc\u5165\u5230postgreSQL\u4e2d",source:"@site/docs/gis/geoserver\u53d1\u5e03\u56fe\u5c42\u670d\u52a1.mdx",sourceDirName:"gis",slug:"/gis/geoserver\u53d1\u5e03\u56fe\u5c42\u670d\u52a1",permalink:"/docs/gis/geoserver\u53d1\u5e03\u56fe\u5c42\u670d\u52a1",draft:!1,unlisted:!1,tags:[{label:"geoserver",permalink:"/docs/tags/geoserver"},{label:"python",permalink:"/docs/tags/python"},{label:"gis",permalink:"/docs/tags/gis"},{label:"qgis",permalink:"/docs/tags/qgis"},{label:"postgresql",permalink:"/docs/tags/postgresql"}],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"geoserver\u53d1\u5e03\u56fe\u5c42\u670d\u52a1",description:"\u4f7f\u7528qgis\u5c06gdb\u6570\u636e\u5bfc\u5165\u5230postgreSQL\u4e2d",date:"2024-5-15",tags:["geoserver","python","gis","qgis","postgresql"]},sidebar:"tutorialSidebar",previous:{title:"geoServer\u53d1\u5e03sld\u6837\u5f0f",permalink:"/docs/gis/geoserver\u53d1\u5e03sld\u6837\u5f0f"},next:{title:"\u5c06mxd\u4e2d\u7684\u56fe\u5c42\u6837\u5f0f\u8f6c\u4e3asld\u6587\u4ef6",permalink:"/docs/gis/mxd2sld"}},i={},d=[{value:"\u901a\u8fc7qgis\u5bfc\u5165\u5230postgresql\u4e2d\u7684\u6240\u6709\u56fe\u5c42\uff0c\u5728geoserver\u4e0a\u9762\u53d1\u5e03\u6210\u5bf9\u5e94\u7684\u670d\u52a1\u3002\u600e\u6837\u80fd\u6279\u91cf\u53d1\u5e03?",id:"\u901a\u8fc7qgis\u5bfc\u5165\u5230postgresql\u4e2d\u7684\u6240\u6709\u56fe\u5c42\u5728geoserver\u4e0a\u9762\u53d1\u5e03\u6210\u5bf9\u5e94\u7684\u670d\u52a1\u600e\u6837\u80fd\u6279\u91cf\u53d1\u5e03",level:2},{value:"1. geoserver\u53ef\u4ee5\u5bf9\u540c\u4e00\u6570\u636e\u6e90\u8fdb\u884c\u591a\u6b21\u53d1\u5e03",id:"1-geoserver\u53ef\u4ee5\u5bf9\u540c\u4e00\u6570\u636e\u6e90\u8fdb\u884c\u591a\u6b21\u53d1\u5e03",level:3},{value:"2. geoServer\u7684REST API\u63d0\u4f9b\u4e86\u83b7\u53d6\u6240\u6709\u6837\u5f0f\u7684\u63a5\u53e3",id:"2-geoserver\u7684rest-api\u63d0\u4f9b\u4e86\u83b7\u53d6\u6240\u6709\u6837\u5f0f\u7684\u63a5\u53e3",level:3},{value:"\u601d\u8def",id:"\u601d\u8def",level:3},{value:"\u4ee3\u7801",id:"\u4ee3\u7801",level:3}];function p(e){const s={admonition:"admonition",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.h2,{id:"\u901a\u8fc7qgis\u5bfc\u5165\u5230postgresql\u4e2d\u7684\u6240\u6709\u56fe\u5c42\u5728geoserver\u4e0a\u9762\u53d1\u5e03\u6210\u5bf9\u5e94\u7684\u670d\u52a1\u600e\u6837\u80fd\u6279\u91cf\u53d1\u5e03",children:"\u901a\u8fc7qgis\u5bfc\u5165\u5230postgresql\u4e2d\u7684\u6240\u6709\u56fe\u5c42\uff0c\u5728geoserver\u4e0a\u9762\u53d1\u5e03\u6210\u5bf9\u5e94\u7684\u670d\u52a1\u3002\u600e\u6837\u80fd\u6279\u91cf\u53d1\u5e03?"}),"\n",(0,r.jsxs)(s.admonition,{title:"\u77e5\u8bc6\u70b9",type:"tip",children:[(0,r.jsx)(s.h3,{id:"1-geoserver\u53ef\u4ee5\u5bf9\u540c\u4e00\u6570\u636e\u6e90\u8fdb\u884c\u591a\u6b21\u53d1\u5e03",children:"1. geoserver\u53ef\u4ee5\u5bf9\u540c\u4e00\u6570\u636e\u6e90\u8fdb\u884c\u591a\u6b21\u53d1\u5e03"}),(0,r.jsx)(s.h3,{id:"2-geoserver\u7684rest-api\u63d0\u4f9b\u4e86\u83b7\u53d6\u6240\u6709\u6837\u5f0f\u7684\u63a5\u53e3",children:"2. geoServer\u7684REST API\u63d0\u4f9b\u4e86\u83b7\u53d6\u6240\u6709\u6837\u5f0f\u7684\u63a5\u53e3"}),(0,r.jsxs)(s.p,{children:["get \u8bf7\u6c42 ",(0,r.jsx)(s.code,{children:"{geoserver_url}/rest/workspaces/{workspace}/styles.json"})]})]}),"\n",(0,r.jsx)(s.h3,{id:"\u601d\u8def",children:"\u601d\u8def"}),"\n",(0,r.jsx)(s.p,{children:"\u7f16\u5199\u811a\u672c\u4f7f\u7528GeoServer REST API"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"\u8c03\u63a5\u53e3\u53d1\u5e03\u56fe\u5c42"}),"\n",(0,r.jsx)(s.li,{children:"\u56fe\u5c42\u8bbe\u7f6e\u6837\u5f0f\uff08\u5982\u679c\u6709\uff09"}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"\u4ee3\u7801",children:"\u4ee3\u7801"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-py",children:'import requests\nimport json\n\n# GeoServer\u7684URL\u548c\u8ba4\u8bc1\u4fe1\u606f\n\ngeoserver_url = "http://xxx.xxx.x.xxx:9090/geoServer"\nusername = "admin"\npassword = "xxx"\n\n# \u6570\u636e\u5b58\u50a8\u914d\u7f6e\nworkspace = "workspace"\ndatastore = "datastore"\ndb_params = {\n    "host": "xxx.xxx.x.xxx",\n    "port": "xxxx",\n    "database": "\u6570\u636e\u5e93\u540d",\n    "user": "postgresql\u7528\u6237\u540d",\n    "passwd": "postgresql\u5bc6\u7801",\n    "dbtype": "postgis"\n}\n\n# \u56fe\u5c42\u5217\u8868\nlayers = [ # \u66ff\u6362\u4e3a\u4f60\u5b9e\u9645\u7684\u56fe\u5c42\u540d\n    {\n        \'db_name\':\'xxx\', # \u6570\u636e\u5e93\u8868\u540d\n        \'name\':\'aaa\', # \u53d1\u5e03\u5230geoserver\u7684\u56fe\u5c42\u540d\n        \'abstract\':\'\u8fd9\u4e2a\u56fe\u5c42\u662f\u5e72\u561b\u7684\', # \u56fe\u5c42\u6458\u8981\n        \'style_name\':\'aa_bb_cc\' # \u6a21\u7cca\u7684geoserver\u6837\u5f0f\u540d \uff08\u8fd9\u91cc\u61d2\u5f97\u5199\u5b8c\u6574\u7684\u6837\u5f0f\u540d\uff0c\u540e\u9762\u5199\u65b9\u6cd5\u6765\u5339\u914d\u4e86\uff09\n    },\n\n]\n\n\n# \u83b7\u53d6\u6240\u6709\u6837\u5f0f\u540d\uff1a\u9700\u8981\u5224\u65adgeoserver\u4e2d\u6709\u6ca1\u6709\u6211\u5199\u7684\u6837\u5f0f\u540d\uff0c\u5982\u679c\u6709\u5219\u7ed9\u56fe\u5c42\u52a0\u4e0a\uff0c\u6ca1\u6709\u5c31\u4e0d\u52a0\u6837\u5f0f\u4e86\ndef get_all_styles():\n    styles_url = f"{geoserver_url}/rest/workspaces/{workspace}/styles.json"\n    response = requests.get(styles_url, auth=(username, password))\n    if response.status_code in [200, 201]:\n        styles = response.json()["styles"]["style"]\n        style_names = [style["name"] for style in styles]\n        return style_names\n    else:\n        print(f"Failed to get styles: {response.text}")\n        return []\n\n# \u4e3a\u4e86\u6a21\u7cca\u67e5\u627egeoserver\u6837\u5f0f\u540d: \n# \u6a21\u7cca\u6837\u5f0f\u540daa_bb_dd_ee, geoserver\u7684\u6837\u5f0f\u540d\u53ef\u80fd\u662faa_bb_cc_dd_ee\uff0c\u6211\u9700\u8981\u62ff\u6a21\u7cca\u540d\u53bb\u627e\u5bf9\u5e94\u7684geoserver\u4e2d\u7684\u6837\u5f0f\u540d    \ndef split_by_second_underscore(s):\n    # \u67e5\u627e\u7b2c\u4e00\u4e2a\u548c\u7b2c\u4e8c\u4e2a\u4e0b\u5212\u7ebf\u7684\u4f4d\u7f6e\n    first_underscore = s.find(\'_\')\n    if first_underscore == -1:\n        return s, \'\'  # \u6ca1\u6709\u4e0b\u5212\u7ebf\n    second_underscore = s.find(\'_\', first_underscore + 1)\n    if second_underscore == -1:\n        return s, \'\'  # \u53ea\u6709\u4e00\u4e2a\u4e0b\u5212\u7ebf\n    # \u5206\u5272\u5b57\u7b26\u4e32\n    return s[:second_underscore], s[second_underscore + 1:]\n\ndef split_string(s):\n    # \u67e5\u627e\u7b2c\u4e00\u4e2a\u3001\u7b2c\u4e8c\u4e2a\u548c\u7b2c\u4e09\u4e2a\u4e0b\u5212\u7ebf\u7684\u4f4d\u7f6e\n    first_underscore = s.find(\'_\')\n    if first_underscore == -1:\n        return s, \'\'  # \u6ca1\u6709\u4e0b\u5212\u7ebf\n    second_underscore = s.find(\'_\', first_underscore + 1)\n    if second_underscore == -1:\n        return s, \'\'  # \u53ea\u6709\u4e00\u4e2a\u4e0b\u5212\u7ebf\n    third_underscore = s.find(\'_\', second_underscore + 1)\n    if third_underscore == -1:\n        return s, \'\'  # \u53ea\u6709\u4e24\u4e2a\u4e0b\u5212\u7ebf\n\n    # \u6839\u636e\u4e0b\u5212\u7ebf\u4f4d\u7f6e\u5206\u5272\u5b57\u7b26\u4e32\n    part1 = s[:second_underscore]\n    part2 = s[third_underscore + 1:]\n\n    return part1, part2\n\n# \u6a21\u7cca\u67e5\u627e\u6837\u5f0f\u540d\ndef find_matching_style(partial_name, style_names):\n    partial_prefix, partial_suffix = split_by_second_underscore(partial_name)\n    for style_name in style_names:\n        tmp_prefix, tmp_suffix = split_string(style_name)\n        if partial_prefix ==  tmp_prefix and partial_suffix == tmp_suffix:\n            return style_name\n    return None\n\n# \u83b7\u53d6\u6240\u6709\u6837\u5f0f\u540d\nstyle_names = get_all_styles()\n\n# \u53d1\u5e03\u56fe\u5c42\ndef publish_layer(layerInfo):\n    layer_name = layerInfo["name"]\n    db_name = layerInfo["db_name"]\n    abstract = layerInfo["abstract"]\n    style_name = layerInfo[\'style_name\']\n    layer_url = f"{geoserver_url}/rest/workspaces/{workspace}/datastores/{datastore}/featuretypes"\n    headers = {"Content-Type": "application/json"}\n    payload = {\n        "featureType": {\n            "name": layer_name,\n            "nativeName": db_name,\n            "title": layer_name,\n            "abstract": abstract,\n        }\n    }\n    response = requests.post(layer_url, auth=(username, password), headers=headers, json=payload)\n    if response.status_code in [200, 201]:\n        print(f"Layer {layer_name} published successfully")\n    else:\n        print(f"Failed to publish layer {layer_name}: {response.text}")\n\n    # \u627e\u5230\u5339\u914d\u7684\u6837\u5f0f\u540d\n    matching_style = find_matching_style(style_name, style_names)\n    # \u8bbe\u7f6e\u56fe\u5c42\u6837\u5f0f\n    if matching_style:\n      style_url = f"{geoserver_url}/rest/layers/{workspace}:{layer_name}"\n      payload = {\n          "layer": {\n              "defaultStyle": {\n                  "name": matching_style,\n                  "workspace": workspace\n              }\n          }\n      }\n      response = requests.put(style_url, auth=(username, password), headers=headers, json=payload)\n      if response.status_code in [200, 201]:\n          print(f"Style {matching_style} applied to layer {layer_name} successfully")\n      else:\n          print(f"Failed to apply style {matching_style} to layer {layer_name}: {response.text}")\n\n\n# \u6279\u91cf\u53d1\u5e03\u56fe\u5c42\nfor layerInfo in layers:\n    publish_layer(layerInfo)\n'})}),"\n",(0,r.jsx)(s.hr,{})]})}function c(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>l});var r=n(6540);const t={},a=r.createContext(t);function o(e){const s=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(a.Provider,{value:s},e.children)}}}]);