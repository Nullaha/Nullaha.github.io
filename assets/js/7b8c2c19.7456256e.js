"use strict";(self.webpackChunknullaha_github_io=self.webpackChunknullaha_github_io||[]).push([[3560],{6469:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>a,contentTitle:()=>p,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>l});var t=i(4848),s=i(8453);const r={sidebar_position:1,title:"popup widget",description:"\u6d4b\u91cf\u5de5\u5177\u76f8\u5173\u5185\u5bb9",date:"2024-5-24",tags:["arcgis for js4"]},p=void 0,o={id:"gis/arcgis/popup-widget",title:"popup widget",description:"\u6d4b\u91cf\u5de5\u5177\u76f8\u5173\u5185\u5bb9",source:"@site/docs/gis/arcgis/popup-widget.mdx",sourceDirName:"gis/arcgis",slug:"/gis/arcgis/popup-widget",permalink:"/docs/gis/arcgis/popup-widget",draft:!1,unlisted:!1,tags:[{label:"arcgis for js4",permalink:"/docs/tags/arcgis-for-js-4"}],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"popup widget",description:"\u6d4b\u91cf\u5de5\u5177\u76f8\u5173\u5185\u5bb9",date:"2024-5-24",tags:["arcgis for js4"]},sidebar:"gisSidebar",previous:{title:"measurement widget",permalink:"/docs/gis/arcgis/measurement-widget"},next:{title:"shp\u6587\u4ef6\u5750\u6807\u7cfb\u8f6c\u6362",permalink:"/docs/gis/arcgis/shp\u6587\u4ef6\u5750\u6807\u7cfb\u8f6c\u6362"}},a={},l=[{value:"\u81ea\u5b9a\u4e49\u7c7b\u540d?",id:"\u81ea\u5b9a\u4e49\u7c7b\u540d",level:2},{value:"\u9700\u6c42",id:"\u9700\u6c42",level:3},{value:"\u601d\u8def",id:"\u601d\u8def",level:3},{value:"<del>\u5b9e\u73b01</del>",id:"\u5b9e\u73b01",level:3},{value:"\u5b9e\u73b02",id:"\u5b9e\u73b02",level:3},{value:"wait cursor",id:"wait-cursor",level:2},{value:"\u9700\u6c42\uff1a",id:"\u9700\u6c42-1",level:3},{value:"\u601d\u8def\uff1a",id:"\u601d\u8def-1",level:3},{value:"\u5b9e\u73b0\uff1a",id:"\u5b9e\u73b0",level:3},{value:"\u6ce8\u610f",id:"\u6ce8\u610f",level:3},{value:"\u4fee\u6539\u6837\u5f0f",id:"\u4fee\u6539\u6837\u5f0f",level:2},{value:"\u9700\u6c42\uff1a",id:"\u9700\u6c42-2",level:3},{value:"\u601d\u8def\uff1a",id:"\u601d\u8def-2",level:3},{value:"\u62d6\u62fd\u5f39\u7a97",id:"\u62d6\u62fd\u5f39\u7a97",level:2},{value:"\u601d\u8def",id:"\u601d\u8def-3",level:3},{value:"\u5b9e\u73b0",id:"\u5b9e\u73b0-1",level:3},{value:"\u76f8\u5173\u6e90\u7801",id:"\u76f8\u5173\u6e90\u7801",level:2}];function c(n){const e={a:"a",br:"br",code:"code",del:"del",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.h2,{id:"\u81ea\u5b9a\u4e49\u7c7b\u540d",children:"\u81ea\u5b9a\u4e49\u7c7b\u540d?"}),"\n",(0,t.jsx)(e.h3,{id:"\u9700\u6c42",children:"\u9700\u6c42"}),"\n",(0,t.jsx)(e.p,{children:"\u8bbe\u7f6e\u5f39\u7a97\u7684\u9ad8/\u5bbd"}),"\n",(0,t.jsx)(e.h3,{id:"\u601d\u8def",children:"\u601d\u8def"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsx)(e.li,{}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-css",children:".esri-popup__main-container {\n    width: 600px !important;\n    min-height: 400px !important;\n}\n\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u4f1a\u6c61\u67d3\u5168\u5c40\u3002"}),"\n",(0,t.jsxs)(e.ol,{start:"2",children:["\n",(0,t.jsx)(e.li,{children:"\u81ea\u5b9a\u4e49\u7c7b\u540d"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-md",children:"pop.container = div\n"})}),"\n",(0,t.jsx)(e.h3,{id:"\u5b9e\u73b01",children:(0,t.jsx)(e.del,{children:"\u5b9e\u73b01"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:"const pop = new Popup()\nconst containerEl = document.createElement('div')\ncontainerEl.className = 'xixi-popup'\n\npop.container = containerEl\n\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-css",children:".xixi-popup .esri-popup__main-container {\n    width: 600px !important;\n    min-height: 400px !important;\n}\n\n"})}),"\n",(0,t.jsx)(e.h3,{id:"\u5b9e\u73b02",children:"\u5b9e\u73b02"}),"\n",(0,t.jsx)(e.p,{children:"\u5b9e\u73b01 \u4f1a\u6709bug\u3002hhhhh"}),"\n",(0,t.jsx)(e.p,{children:"\u5982\u679c\u6298\u53e0\u5f39\u7a97\uff0c\u56e0\u4e3a\u8bbe\u7f6e\u4e86min-height: 400px; \u4f1a\u5bfc\u81f4\u5f39\u7a97\u65e0\u6cd5\u6298\u53e0."}),"\n",(0,t.jsx)(e.p,{children:"\u5e94\u8be5\u7528max-height"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-css",children:".xixi-popup .esri-popup__main-container {\n    width: 600px !important;\n    max-height: 400px !important;\n}\n\n"})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"wait-cursor",children:"wait cursor"}),"\n",(0,t.jsx)(e.h3,{id:"\u9700\u6c42-1",children:"\u9700\u6c42\uff1a"}),"\n",(0,t.jsx)(e.p,{children:"\u70b9\u51fb\u56fe\u6591\uff0c \u5f39\u51fa\u5f39\u7a97\u3002 \u4e2d\u95f4\u7b49\u5f85\u7684\u65f6\u95f4\u5e0c\u671b\u6709\u4e00\u4e2aloading\u3002"}),"\n",(0,t.jsx)(e.h3,{id:"\u601d\u8def-1",children:"\u601d\u8def\uff1a"}),"\n",(0,t.jsx)(e.p,{children:"\u7528 arcgis/core \u91cc\u7684Spinner"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.a,{href:"https://community.esri.com/t5/arcgis-javascript-maps-sdk-questions/wait-cursor/m-p/276001",children:"\u53c2\u8003\uff1a\u5b98\u65b9\u8bba\u575b wait cursor"})}),"\n",(0,t.jsx)(e.h3,{id:"\u5b9e\u73b0",children:"\u5b9e\u73b0\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:"import Spinner from '@arcgis/core/widgets/Spinner.js';\nthis.spinner = new Spinner({\n    view,\n});\nview.ui.add(this.spinner);\n\nasync query(qGeom, mapPoint) {\n    this._showSpinner(mapPoint);\n}\nthis.watchHandler = this.view.popup.watch('visible', (newValue, oldValue, name) => {\n    if (!newValue) {\n        // ...\n    }\n    this._hideSpinner();\n});\n/**\n * helper\n */\n_showSpinner(location) {\n    this.spinner.show({\n        location: location,\n    });\n}\n_hideSpinner() {\n    this.spinner.hide();\n}\n"})}),"\n",(0,t.jsx)(e.h3,{id:"\u6ce8\u610f",children:"\u6ce8\u610f"}),"\n",(0,t.jsx)(e.p,{children:"\u5982\u679cloading\u56fe\u6591\u4e0d\u663e\u793a\uff0c\u63a7\u5236\u53f0\u62a5\u9519404\u627e\u4e0d\u5230\u3002"}),"\n",(0,t.jsxs)(e.p,{children:["\u628abase/theme/light/main.css\u672c\u5730\u5316\u3002",(0,t.jsx)(e.br,{}),"\n",(0,t.jsx)(e.a,{href:"https://nullaha.github.io//docs/gis/arcgis/arcgiscore%E6%9C%AC%E5%9C%B0%E5%8C%96",children:"\u53c2\u8003\uff1aarcigs/core 4 \u672c\u5730\u5316"})]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"\u4fee\u6539\u6837\u5f0f",children:"\u4fee\u6539\u6837\u5f0f"}),"\n",(0,t.jsx)(e.p,{children:"TODO:"}),"\n",(0,t.jsx)(e.h3,{id:"\u9700\u6c42-2",children:"\u9700\u6c42\uff1a"}),"\n",(0,t.jsx)(e.p,{children:"\u6211\u4e0d\u60f3\u8981\u5b83\u81ea\u5e26\u7684\u6837\u5f0f\uff0c\u6211\u8981\u4fee\u6539\uff01\uff01"}),"\n",(0,t.jsx)(e.h3,{id:"\u601d\u8def-2",children:"\u601d\u8def\uff1a"}),"\n",(0,t.jsx)(e.p,{children:"\u5177\u96be\u6539\uff01"}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"\u62d6\u62fd\u5f39\u7a97",children:"\u62d6\u62fd\u5f39\u7a97"}),"\n",(0,t.jsx)(e.h3,{id:"\u601d\u8def-3",children:"\u601d\u8def"}),"\n",(0,t.jsxs)(e.p,{children:["\u7ffb\u4e86\u7ffb\u4e92\u8054\u7f51 3.x \u53ef\u4ee5\u901a\u8fc7dojo/Movable\u6765\u5b9e\u73b0\u62d6\u62fd\u529f\u80fd",(0,t.jsx)(e.br,{}),"\n",(0,t.jsx)(e.a,{href:"https://community.esri.com/t5/arcgis-javascript-maps-sdk-questions/is-it-possible-to-make-the-infowindow-pop-up/m-p/253400#M23440",children:"\u53c2\u8003\uff1a \u4f8b\u5b50"})]}),"\n",(0,t.jsx)(e.p,{children:"4.x \u5df2\u7ecf\u627e\u4e0d\u5230\u8fd9\u4e2a\u7c7b\u4e86"}),"\n",(0,t.jsxs)(e.p,{children:["\u7f51\u4e0a\u770b\u5230\u7684\u65b9\u6cd5\u90fd\u662f\u7528interact\u5e93\u7684",(0,t.jsx)(e.br,{}),"\n",(0,t.jsx)(e.a,{href:"https://gavinr.com/draggable-popup-arcgis-javascript/",children:"\u53c2\u8003\uff1a\u4f8b\u5b501"})]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.a,{href:"https://interactjs.io/docs/draggable/",children:"\u53c2\u8003\uff1ainteractjs\u5e93"}),"\n",(0,t.jsx)(e.a,{href:"https://github.com/taye/interact.js",children:"\u53c2\u8003\uff1ainteractjs\u5e93 github"}),"\n",(0,t.jsx)(e.a,{href:"https://github.com/taye/interact.js/blob/main/docs/faq.md",children:"\u53c2\u8003\uff1ainteractjs\u5e93 destroy api"})]}),"\n",(0,t.jsx)(e.h3,{id:"\u5b9e\u73b0-1",children:"\u5b9e\u73b0"}),"\n",(0,t.jsx)(e.p,{children:"vue + vite + arcgis/core 4.x"}),"\n",(0,t.jsxs)(e.p,{children:["\u5b89\u88c5 ",(0,t.jsx)(e.code,{children:"npm install interactjs"})]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:"import { createVNode, render } from 'vue';\nimport PopupContentConstructor from './popupTemplate.vue';\nimport Popup from '@arcgis/core/widgets/Popup.js';\nimport * as reactiveUtils from '@arcgis/core/core/reactiveUtils.js';\nimport interact from 'interactjs';\n\nclass Test{\n    constructor(mapView){\n        this.view = mapView;\n        this.popupContainer = document.createElement('div');\n        this.popupClassName = 'aha-esri-popup';\n        this.popupTargetStr = '.aha-esri-popup.esri-component';\n        this.popupTitle = `\n            <div class=\"custom-esri-popup-title\">\n                <span>\u5c5e\u6027\u4fe1\u606f</span>\n            </div>\n        `;\n        this.watchHandler = null;\n    }\n}\n\ninitInstance(props) {\n    // container.style.height = '500px';\n    const vnode = createVNode(PopupContentConstructor, {\n        ...props,\n        // onDestroy: () => {\n        //     render(null, this.popupContainer);\n        // },\n    });\n    render(vnode, this.popupContainer);\n    return this.popupContainer;\n}\n\nshowPopup(payload, mapPoint) {\n    const popup = new Popup();\n    const container = document.createElement('div');\n    container.className = this.popupClassName;\n\n    popup.container = container;\n    popup.location = mapPoint;\n    popup.title = this.popupTitle;\n\n    this.view.popup = popup;\n    popup.content = this.initInstance({\n        payload,\n        view2: this.view,\n    });\n    // this.view.popup.open();\n    this.view.popup.dockEnabled = true;\n    this.view.popup.dockOptions = {\n        breakpoint: false,\n        position: 'top-right',\n    };\n    // this.view.popup.dockOptions = null;\n    this.view.popup.dockOptions.buttonEnabled = false;\n    this.view.popup.viewModel.includeDefaultActions = false;\n\n    this.watchHandler = this.view.popup.watch('visible', (newValue, oldValue, name) => {\n        if (!newValue) {\n            this.hlLayer?.removeAll();\n            this.watchHandler?.remove();\n            this.watchHandler = null;\n            render(null, this.popupContainer);\n            this.view.popup.content = null;\n        }\n        // this._hideSpinner();\n    });\n    this.view.popup.visible = true;\n    setTimeout(() => {\n        popup.reposition();\n    }, 10);\n\n    //\n    reactiveUtils\n        .whenOnce(() => this.view.popup?.visible)\n        .then(() => {\n            // draggle\n            this.setupDraggle();\n\n            // style\n            // ...\n        });\n}\n\n// popup draggle\ndestroyDraggle(target) {\n    interact(target)?.unset();\n}\nsetupDraggle() {\n    const targetStr = this.popupTargetStr;\n    this.destroyDraggle(targetStr);\n    // setup the new listener:\n    const position = { x: 0, y: 0 };\n    interact(targetStr).draggable({\n        listeners: {\n            // start(event) {\n            //   console.log(event.type, event.target);\n            // },\n            move(event) {\n                // console.log(event.type, event.target);\n\n                // hide the popup pointer:\n                // const elements = document.querySelectorAll(\".esri-popup__pointer\");\n                // elements[0].style.display = \"none\";\n\n                // calculate the position and update:\n                position.x += event.dx;\n                position.y += event.dy;\n\n                event.target.style.transform = `translate(${position.x}px, ${position.y}px)`;\n            },\n        },\n    });\n}\n\n"})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"\u76f8\u5173\u6e90\u7801",children:"\u76f8\u5173\u6e90\u7801"})]})}function d(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(c,{...n})}):c(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>p,x:()=>o});var t=i(6540);const s={},r=t.createContext(s);function p(n){const e=t.useContext(r);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:p(n.components),t.createElement(r.Provider,{value:e},n.children)}}}]);